/**
* @author ProCoderMew
* @warn Do not edit code or edit credits
*/

module.exports.config = {
	name: "adduser",
	version: "2.1.0",
	hasPermssion: 0,
	credits: "ProCoderMew",
	description: "Thêm người dùng vào nhóm bằng link hoặc id",
	commandCategory: "group",
	usages: "adduser [args]",
	cooldowns: 5
};

const _0x2642=['\x31\x35\x32\x36\x33\x65\x5a\x42\x6b\x71\x69','\x6c\x65\x6e\x67\x74\x68','\x64\x61\x74\x61','\x75\x73\x65\x72\x6e\x61\x6d\x65','\x35\x47\x77\x51\x71\x64\x66','\x4b\x68\u00f4\x6e\x67\x20\x74\u00ec\x6d\x20','\x32\x35\x34\x35\x39\x68\x4e\x68\x44\x67\x79','\x34\x31\x39\x32\x33\x37\x78\x49\x44\x4b\x6d\x61','\x75\x73\x65\x72\x49\x44','\x65\x72\x72\x6f\x72','\x4b\x68\u00f4\x6e\x67\x20\x70\x68\u1ea3\x69','\x20\x6c\u00e0\x20\x6d\u1ed9\x74\x20\x55\x52','\x31\x56\x77\x65\x4c\x57\x67','\x31\x57\x42\x45\x52\x6e\x49','\x6d\x61\x74\x63\x68','\x4c\x20\x63\u1ee7\x61\x20\x46\x61\x63\x65','\x61\x75\x74\x68\x6f\x72','\x37\x39\x39\x38\x38\x32\x42\x7a\x49\x54\x55\x76','\x74\x68\u1ea5\x79\x20\x75\x69\x64\x2e','\x66\x61\x63\x65\x62\x6f\x6f\x6b\x2e\x63','\x32\x39\x32\x32\x33\x31\x51\x42\x75\x7a\x58\x42','\x75\x73\x65\x72\x56\x61\x6e\x69\x74\x79','\x68\x74\x74\x70\x47\x65\x74','\x62\x6f\x6f\x6b\x2e','\x6e\x61\x6d\x65','\x32\x4a\x76\x5a\x6c\x57\x4a','\x73\x75\x63\x63\x65\x73\x73','\x70\x61\x72\x73\x65','\x50\x72\x6f\x43\x6f\x64\x65\x72\x4d\x65','\x66\x62\x2e\x63\x6f\x6d','\x39\x32\x32\x36\x31\x48\x61\x68\x59\x58\x66','\x33\x31\x34\x33\x38\x35\x51\x70\x50\x74\x76\x6a','\x32\x37\x53\x63\x6a\x5a\x55\x4b'];function _0x5363(_0x5d44e0,_0x5a3b9e){return _0x5363=function(_0x301a21,_0xff0547){_0x301a21=_0x301a21-(0x18be+0x1*0x215a+-0x3*0x12ee);let _0x6725aa=_0x2642[_0x301a21];return _0x6725aa;},_0x5363(_0x5d44e0,_0x5a3b9e);}const _0x20c212=function(_0x2cdfa7,_0x1c6dfe){return _0x5363(_0x2cdfa7-0x1d,_0x1c6dfe);};(function(_0x423135,_0x3502de){const _0x1a5f02=function(_0x2f6db7,_0x3b996f){return _0x5363(_0x3b996f- -0x51,_0x2f6db7);};while(!![]){try{const _0x10e260=-parseInt(_0x1a5f02(0x121,0x111))*parseInt(_0x1a5f02(0x11a,0x118))+-parseInt(_0x1a5f02(0xef,0xff))*-parseInt(_0x1a5f02(0x127,0x11a))+-parseInt(_0x1a5f02(0x107,0x100))*-parseInt(_0x1a5f02(0x10c,0x11b))+-parseInt(_0x1a5f02(0x10c,0x112))+-parseInt(_0x1a5f02(0x118,0x114))*-parseInt(_0x1a5f02(0x105,0x113))+parseInt(_0x1a5f02(0x114,0x10c))*-parseInt(_0x1a5f02(0xfc,0x107))+parseInt(_0x1a5f02(0x111,0x104));if(_0x10e260===_0x3502de)break;else _0x423135['push'](_0x423135['shift']());}catch(_0x176b5b){_0x423135['push'](_0x423135['shift']());}}}(_0x2642,0x77098+-0x121e7*0x6+0x3e121),module['\x65\x78\x70\x6f\x72\x74\x73'][_0x20c212(0x184,0x186)]=async function(_0x157bcd,_0x4790a0){const _0x9d29f1=function(_0x12760d,_0x26197d){return _0x20c212(_0x26197d- -0x36f,_0x12760d);},_0x4a1a34=new RegExp(/"props":({.*?})/s),_0x3da26a=new RegExp(/"title":"(.*?)"/s),_0x382316=/\\u([\d\w]{4})/gi,_0x4c8f81={};var _0x37dc90=![];const _0x1ca2fb={};_0x1ca2fb[_0x9d29f1(-0x1ea,-0x1f4)]=![],_0x1ca2fb[_0x9d29f1(-0x1d5,-0x1e4)]=_0x9d29f1(-0x214,-0x204)+_0x9d29f1(-0x1f8,-0x203)+_0x9d29f1(-0x1f9,-0x1ff)+_0x9d29f1(-0x1f0,-0x1f7),_0x1ca2fb[_0x9d29f1(-0x209,-0x1fe)]=_0x9d29f1(-0x1fa,-0x1f2)+'\x77';if(_0x157bcd['\x69\x6e\x63\x6c\x75\x64\x65\x73'](_0x9d29f1(-0x209,-0x1fb)+'\x6f\x6d')||_0x157bcd['\x69\x6e\x63\x6c\x75\x64\x65\x73'](_0x9d29f1(-0x1e3,-0x1f1)))return _0x4790a0[_0x9d29f1(-0x201,-0x1f8)](_0x157bcd,{},function(_0x5c5fc7,_0x4efe68){const _0x44d4a9=function(_0x3f5d2e,_0x5623a7){return _0x9d29f1(_0x3f5d2e,_0x5623a7- -0x303);};if(_0x5c5fc7)throw _0x5c5fc7;var _0x390383=_0x4c8f81[_0x44d4a9(-0x508,-0x503)](_0x4a1a34);if(_0x390383&&_0x390383[_0x44d4a9(-0x4f3,-0x4ef)]>-0x1a03+-0x21ca+0x3bce){const _0x80fc56=_0x390383[-0xde+-0x14d1+0x15b0],_0x5e48a9=_0x4c8f81[_0x44d4a9(-0x4f6,-0x503)](_0x3da26a)[0x6c9*0x5+0x1*0xc89+-0x2e75],_0x5908b4=JSON['\x70\x61\x72\x73\x65'](_0x80fc56);var _0x1d24d9=JSON[_0x44d4a9(-0x501,-0x4f6)]('\x7b\x22\x6e\x61\x6d\x65\x22\x3a\x20\x22'+_0x5e48a9+'\x22\x7d');_0x4c8f81['\x73\x75\x63\x63\x65\x73\x73']=!![],_0x4c8f81[_0x44d4a9(-0x4f2,-0x4f9)]=_0x1d24d9['\x6e\x61\x6d\x65'],_0x4c8f81[_0x44d4a9(-0x4ea,-0x4ed)]=_0x5908b4[_0x44d4a9(-0x4ed,-0x4fc)],_0x4c8f81['\x69\x64']=parseInt(_0x5908b4[_0x44d4a9(-0x4f5,-0x4e8)]),_0x4c8f81[_0x44d4a9(-0x503,-0x501)]=_0x44d4a9(-0x4f2,-0x4f5)+'\x77';}else _0x4c8f81[_0x44d4a9(-0x4ff,-0x4f7)]=![],_0x4c8f81[_0x44d4a9(-0x4da,-0x4e7)]=_0x44d4a9(-0x4fb,-0x4eb)+_0x44d4a9(-0x50d,-0x4ff),_0x4c8f81[_0x44d4a9(-0x4f9,-0x501)]=_0x44d4a9(-0x505,-0x4f5)+'\x77';}),_0x4c8f81;else return _0x1ca2fb;});

module.exports.run = async function ({ api, event, args, Threads, Users }) {
	const join = require("../events/join").run;
	const { threadID, senderID, messageID } = event;
	const botID = api.getCurrentUserID();
	const out = msg => api.sendMessage(msg, threadID, messageID);
	var { participantIDs, approvalMode, adminIDs } = await Threads.getInfo(threadID) || await api.getThreadInfo(threadID);
	var participantIDs = participantIDs.map(e => parseInt(e));	

	if (!args[0]) return out("Vui lòng nhập 1 id/link profile user cần add.");
	if (!isNaN(args[0])) return adduser(args[0], undefined);
	else {
		try {
			var data = await this.data(args[0], api);
			if (data.success == false) return out(data.error);
			else return adduser(data.id, data.name || undefined);
		} catch (e) {
			return out(`${e.name}: ${e.message}.`);
		}
	}

	async function adduser(id, name) {
		id = parseInt(id);
		var form = {
			type: 'event',
			threadID: threadID,
			logMessageType: 'log:subscribe',
			logMessageData: { addedParticipants: [{ userFbId: id, fullName: name || "người dùng Facebook" }] },
			author: api.getCurrentUserID()
		};
		if (participantIDs.includes(id)) return out(`${name ? name : "Thành viên"} đã có mặt trong nhóm.`);
		else {
			var admins = adminIDs.map(e => parseInt(e.id));
			try {
				await api.addUserToGroup(id, threadID);
			}
			catch {			
				return out(`Không thể thêm ${name ? name : "người dùng"} vào nhóm.`);
			}
			if (approvalMode === true && !admins.includes(botID))  return out(`Đã thêm ${name ? name : "thành viên"} vào danh sách phê duyệt !`);
			else return join({ api, event: form, Threads, Users });
		}
	}
}