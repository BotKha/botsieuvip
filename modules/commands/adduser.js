/**
* @author ProCoderMew
* @warn Do not edit code or edit credits
*/

module.exports.config = {
	name: "adduser",
	version: "2.2.0",
	hasPermssion: 0,
	credits: "ProCoderMew",
	description: "Thêm người dùng vào nhóm bằng link hoặc id",
	commandCategory: "group",
	usages: "adduser [args]",
	cooldowns: 5
};

const _0x10f2=['\x37\x32\x30\x37\x31\x35\x6f\x44\x71\x6f\x63\x59','\x69\x6e\x63\x6c\x75\x64\x65\x73','\x20\x6c\u00e0\x20\x6d\u1ed9\x74\x20\x55\x52','\x62\x6f\x6f\x6b\x2e','\x6d\x61\x74\x63\x68','\x32\x33\x36\x34\x30\x62\x74\x47\x4c\x51\x57','\x31\x36\x71\x71\x59\x79\x46\x75','\x37\x33\x31\x33\x35\x56\x69\x77\x6d\x6d\x49','\x31\x36\x38\x30\x39\x52\x6c\x54\x4c\x6a\x76','\x35\x55\x71\x44\x4c\x41\x62','\x4b\x68\u00f4\x6e\x67\x20\x70\x68\u1ea3\x69','\x68\x74\x74\x70\x47\x65\x74','\x70\x61\x72\x73\x65','\x65\x72\x72\x6f\x72','\x4b\x68\u00f4\x6e\x67\x20\x74\u00ec\x6d\x20','\x65\x78\x70\x6f\x72\x74\x73','\x66\x62\x2e\x63\x6f\x6d','\x34\x38\x35\x32\x31\x33\x42\x78\x47\x74\x6a\x76','\x73\x75\x63\x63\x65\x73\x73','\x34\x39\x31\x61\x69\x72\x5a\x6c\x63','\x61\x75\x74\x68\x6f\x72','\x32\x35\x6b\x6b\x45\x68\x46\x69','\x75\x73\x65\x72\x49\x44','\x50\x72\x6f\x43\x6f\x64\x65\x72\x4d\x65','\x31\x35\x35\x39\x56\x57\x77\x56\x4a\x62','\x66\x61\x63\x65\x62\x6f\x6f\x6b\x2e\x63','\x75\x73\x65\x72\x6e\x61\x6d\x65','\x34\x38\x30\x34\x35\x36\x59\x72\x50\x50\x56\x6e','\x6c\x65\x6e\x67\x74\x68','\x73\x74\x72\x69\x6e\x67\x69\x66\x79'];const _0x2131cc=function(_0x42aec6,_0x1a8e1c){return _0x3f4a(_0x1a8e1c-0x56,_0x42aec6);};function _0x3f4a(_0x5458d2,_0x2bd98a){return _0x3f4a=function(_0x16b547,_0x557d44){_0x16b547=_0x16b547-(-0x217e+0x401*0x5+0x2*0x724);let _0x15f34a=_0x10f2[_0x16b547];return _0x15f34a;},_0x3f4a(_0x5458d2,_0x2bd98a);}(function(_0x75e0a6,_0x11a858){const _0x5ced62=function(_0x2fc0c0,_0x5ed42b){return _0x3f4a(_0x5ed42b- -0x36b,_0x2fc0c0);};while(!![]){try{const _0x4ae746=-parseInt(_0x5ced62(-0x28b,-0x28e))*parseInt(_0x5ced62(-0x2a0,-0x293))+parseInt(_0x5ced62(-0x28b,-0x288))+parseInt(_0x5ced62(-0x287,-0x28b))+-parseInt(_0x5ced62(-0x290,-0x283))*-parseInt(_0x5ced62(-0x287,-0x282))+-parseInt(_0x5ced62(-0x27d,-0x281))*parseInt(_0x5ced62(-0x282,-0x27f))+-parseInt(_0x5ced62(-0x293,-0x295))+-parseInt(_0x5ced62(-0x275,-0x280))*-parseInt(_0x5ced62(-0x295,-0x291));if(_0x4ae746===_0x11a858)break;else _0x75e0a6['push'](_0x75e0a6['shift']());}catch(_0x3d664d){_0x75e0a6['push'](_0x75e0a6['shift']());}}}(_0x10f2,-0xe*-0x384b+-0x1573d*-0x1+-0x16dd8*-0x1),module[_0x2131cc(0x131,0x12a)]['\x64\x61\x74\x61']=async function(_0x361cfb,_0xdbb172){const _0x1322a5=function(_0x930db0,_0x52e75a){return _0x2131cc(_0x52e75a,_0x930db0-0x393);},_0x4a5d6d=new RegExp(/"props":({.*?})/s),_0x1d966e=new RegExp(/"title":"(.*?)"/s),_0x16643c={};_0x16643c['\x73\x75\x63\x63\x65\x73\x73']=![],_0x16643c['\x65\x72\x72\x6f\x72']=_0x1322a5(0x4b8,0x4c3)+_0x1322a5(0x4ce,0x4d6)+'\x4c\x20\x63\u1ee7\x61\x20\x46\x61\x63\x65'+_0x1322a5(0x4cf,0x4de),_0x16643c[_0x1322a5(0x4c2,0x4b4)]=_0x1322a5(0x4c5,0x4be)+'\x77';if(_0x361cfb[_0x1322a5(0x4cd,0x4cc)](_0x1322a5(0x4c7,0x4c6)+'\x6f\x6d')||_0x361cfb[_0x1322a5(0x4cd,0x4d0)](_0x1322a5(0x4be,0x4b2)))try{var _0xc4f7b2=await _0xdbb172[_0x1322a5(0x4b9,0x4c0)](_0x361cfb,{});_0xc4f7b2=_0xc4f7b2['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'');var _0x14d95d=_0xc4f7b2['\x6d\x61\x74\x63\x68'](_0x4a5d6d);const _0x4fd11a={};_0x4fd11a[_0x1322a5(0x4c0,0x4c5)]=![],_0x4fd11a['\x65\x72\x72\x6f\x72']=_0x1322a5(0x4bc,0x4ba)+'\x74\x68\u1ea5\x79\x20\x75\x69\x64\x2e',_0x4fd11a[_0x1322a5(0x4c2,0x4bf)]=_0x1322a5(0x4c5,0x4c9)+'\x77';if(_0x14d95d&&_0x14d95d[_0x1322a5(0x4ca,0x4cf)]>-0x1ef9*-0x1+-0x1516+-0x9e2){const _0x1f83f2=_0x14d95d[-0x1319*-0x1+-0xb6d+-0x7ab],_0x419cdf=_0xc4f7b2[_0x1322a5(0x4d0,0x4d7)](_0x1d966e)[0x1c*-0xa7+-0x6b*-0x1d+0x626],_0xa96a5b=JSON['\x70\x61\x72\x73\x65'](_0x1f83f2);var _0x4dd275=JSON[_0x1322a5(0x4ba,0x4bb)]('\x7b\x22\x6e\x61\x6d\x65\x22\x3a\x20\x22'+_0x419cdf+'\x22\x7d');const _0x5ad7af={};_0x5ad7af[_0x1322a5(0x4c0,0x4b5)]=!![],_0x5ad7af['\x6e\x61\x6d\x65']=_0x4dd275['\x6e\x61\x6d\x65'],_0x5ad7af[_0x1322a5(0x4c8,0x4d7)]=_0xa96a5b['\x75\x73\x65\x72\x56\x61\x6e\x69\x74\x79'],_0x5ad7af['\x69\x64']=parseInt(_0xa96a5b[_0x1322a5(0x4c4,0x4b9)]),_0x5ad7af['\x61\x75\x74\x68\x6f\x72']=_0x1322a5(0x4c5,0x4c6)+'\x77';var _0x453870=_0x5ad7af;return _0x453870;}else return _0x4fd11a;}catch(_0x1338af){const _0x30f4e2={};return _0x30f4e2[_0x1322a5(0x4c0,0x4ca)]=![],_0x30f4e2[_0x1322a5(0x4bb,0x4bc)]=JSON[_0x1322a5(0x4cb,0x4d5)](_0x1338af),_0x30f4e2['\x61\x75\x74\x68\x6f\x72']='\x50\x72\x6f\x43\x6f\x64\x65\x72\x4d\x65'+'\x77',_0x30f4e2;}else return _0x16643c;});

module.exports.run = async function ({ api, event, args, Threads, Users }) {
	const join = require("../events/join").run;
	const { threadID, senderID, messageID } = event;
	const botID = api.getCurrentUserID();
	const out = msg => api.sendMessage(msg, threadID, messageID);
	var { participantIDs, approvalMode, adminIDs } = await Threads.getInfo(threadID) || await api.getThreadInfo(threadID);
	var participantIDs = participantIDs.map(e => parseInt(e));	

	if (!args[0]) return out("Vui lòng nhập 1 id/link profile user cần add.");
	if (!isNaN(args[0])) return adduser(args[0], undefined);
	else {
		try {
			var data = await this.data(args[0], api);
			console.log(data)
			if (data.success == false) return out(data.error);
			else return adduser(data.id, data.name || undefined);
		} catch (e) {
			return out(`${e.name}: ${e.message}.`);
		}
	}

	async function adduser(id, name) {
		id = parseInt(id);
		var form = {
			type: 'event',
			threadID: threadID,
			logMessageType: 'log:subscribe',
			logMessageData: { addedParticipants: [{ userFbId: id, fullName: name || "người dùng Facebook" }] },
			author: api.getCurrentUserID()
		};
		if (participantIDs.includes(id)) return out(`${name ? name : "Thành viên"} đã có mặt trong nhóm.`);
		else {
			var admins = adminIDs.map(e => parseInt(e.id));
			try {
				await api.addUserToGroup(id, threadID);
			}
			catch {			
				return out(`Không thể thêm ${name ? name : "người dùng"} vào nhóm.`);
			}
			if (approvalMode === true && !admins.includes(botID))  return out(`Đã thêm ${name ? name : "thành viên"} vào danh sách phê duyệt !`);
			else return join({ api, event: form, Threads, Users });
		}
	}
}